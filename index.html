<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Planilha Financeira - Funcional (Tailwind)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .dashboard-card { transition: all 0.3s ease; }
        .dashboard-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
        .positive-value { color: #10b981; }
        .negative-value { color: #ef4444; }
        .transaction-list { max-height: 420px; overflow-y: auto; }
        .category-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .tipo-btn.active.receita { background-color: #10b981; color: white; border-color: #10b981; }
        .tipo-btn.active.despesa { background-color: #ef4444; color: white; border-color: #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="bg-white rounded-xl shadow-lg p-6 mb-8 border border-gray-200">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1 class="text-3xl font-bold text-gray-800">
                        <i class="fas fa-chart-pie text-blue-600 mr-2"></i>
                        Planilha Financeira Completa
                    </h1>
                    <p class="text-gray-600">Controle total dos seus gastos, receitas e investimentos.</p>
                </div>
                <div class="text-center space-y-2">
                    <div class="text-2xl font-bold text-blue-600" id="current-date"></div>
                    <div class="text-sm text-gray-500">Data atual</div>
                    <div class="mt-2 flex items-center gap-2">
                        <label class="text-sm text-gray-600">Saldo Inicial</label>
                        <input id="saldo-inicial" type="number" step="0.01" class="w-40 p-2 border rounded-md" />
                    </div>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
            <div class="dashboard-card bg-gradient-to-br from-white to-blue-50 rounded-xl shadow-md p-6 border border-blue-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Saldo em Caixa</p>
                        <h2 class="text-2xl font-bold text-blue-700" id="saldo-caixa">R$ 0,00</h2>
                    </div>
                    <div class="bg-blue-100 p-3 rounded-full">
                        <i class="fas fa-wallet text-blue-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="dashboard-card bg-gradient-to-br from-white to-red-50 rounded-xl shadow-md p-6 border border-red-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Total Gastos</p>
                        <h2 class="text-2xl font-bold negative-value" id="total-gastos">R$ 0,00</h2>
                    </div>
                    <div class="bg-red-100 p-3 rounded-full">
                        <i class="fas fa-money-bill-wave text-red-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="dashboard-card bg-gradient-to-br from-white to-green-50 rounded-xl shadow-md p-6 border border-green-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Total Receitas</p>
                        <h2 class="text-2xl font-bold positive-value" id="total-receitas">R$ 0,00</h2>
                    </div>
                    <div class="bg-green-100 p-3 rounded-full">
                        <i class="fas fa-coins text-green-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="dashboard-card bg-gradient-to-br from-white to-purple-50 rounded-xl shadow-md p-6 border border-purple-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Saldo do Dia</p>
                        <h2 class="text-2xl font-bold text-purple-700" id="saldo-dia">R$ 0,00</h2>
                    </div>
                    <div class="bg-purple-100 p-3 rounded-full">
                        <i class="fas fa-chart-pie text-purple-600 text-xl"></i>
                    </div>
                </div>
            </div>
            <div class="dashboard-card bg-gradient-to-br from-white to-orange-50 rounded-xl shadow-md p-6 border border-orange-100">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-600 text-sm font-medium">Investimento Cripto (líquido)</p>
                        <h2 class="text-2xl font-bold text-orange-700" id="total-cripto">R$ 0,00</h2>
                    </div>
                    <div class="bg-orange-100 p-3 rounded-full">
                        <i class="fab fa-bitcoin text-orange-600 text-xl"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-plus-circle text-blue-600 mr-2"></i>
                        Nova Transação
                    </h2>
                    
                    <form id="transaction-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" id="btn-receita" class="tipo-btn bg-gray-100 text-gray-700 py-2 px-4 rounded-lg border border-gray-200 font-medium hover:bg-gray-200 transition-colors" data-tipo="receita">
                                    <i class="fas fa-arrow-up mr-2"></i>Receita
                                </button>
                                <button type="button" id="btn-despesa" class="tipo-btn bg-red-100 text-red-700 py-2 px-4 rounded-lg border border-red-300 font-medium hover:bg-red-200 transition-colors" data-tipo="despesa">
                                    <i class="fas fa-arrow-down mr-2"></i>Despesa
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Categoria</label>
                            <select id="categoria" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                                <optgroup label="Despesas">
                                    <option value="alimentacao">Alimentação</option>
                                    <option value="transporte">Transporte</option>
                                    <option value="apostas">Apostas Esportivas</option>
                                    <option value="cassino">Cassino</option>
                                </optgroup>
                                <optgroup label="Investimentos">
                                    <option value="cripto">Criptomoedas</option>
                                </optgroup>
                                <optgroup label="Receitas">
                                    <option value="pagamento_videos">Pagamento por Vídeos</option>
                                </optgroup>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Descrição</label>
                            <input type="text" id="descricao" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="Ex: Almoço, Uber, Bitcoin, etc.">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor (R$)</label>
                            <input type="number" id="valor" step="0.01" min="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors" placeholder="0,00">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data</label>
                            <input type="date" id="data" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors">
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-4 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-200 font-medium shadow-md">
                            <i class="fas fa-save mr-2"></i>Adicionar Transação
                        </button>
                    </form>
                    <div class="mt-4 text-sm text-gray-500">Dica: registre investimentos em <strong>Criptomoedas</strong> como <em>Despesa</em> (investido) e resgates como <em>Receita</em>.</div>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 mb-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800">
                            <i class="fas fa-list-alt text-blue-600 mr-2"></i>
                            Últimas Transações
                        </h2>
                        <div class="flex space-x-2 items-center">
                            <button id="filter-today" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-blue-200 transition-colors">Hoje</button>
                            <button id="filter-all" class="bg-gray-100 text-gray-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-gray-200 transition-colors">Todos</button>
                            <button id="export-csv" class="bg-green-100 text-green-700 px-3 py-1 rounded-md text-sm font-medium hover:bg-green-200 transition-colors">CSV</button>
                        </div>
                    </div>
                    <div class="transaction-list">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 text-sm font-medium text-gray-600">Data</th>
                                    <th class="text-left py-3 text-sm font-medium text-gray-600">Descrição</th>
                                    <th class="text-left py-3 text-sm font-medium text-gray-600">Categoria</th>
                                    <th class="text-right py-3 text-sm font-medium text-gray-600">Valor</th>
                                    <th class="text-right py-3 text-sm font-medium text-gray-600">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-list">
                                <tr>
                                    <td colspan="5" class="text-center py-8 text-gray-500">Nenhuma transação registrada</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                        Resumo por Categoria
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Despesas</h3>
                            <div class="space-y-3" id="resumo-despesas"></div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-700 mb-4">Receitas</h3>
                            <div class="space-y-3" id="resumo-receitas"></div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Relatório Diário</h3>
                        <div class="flex gap-2 items-center">
                            <input type="date" id="report-date" class="p-2 border rounded-md" />
                            <button id="generate-report" class="bg-blue-100 text-blue-700 px-3 py-2 rounded-md">Gerar Relatório</button>
                        </div>
                        <div id="report-output" class="mt-4 text-sm text-gray-700"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuração e Helpers ---
        const API_URL = '/api/transactions';
        const STORAGE_SALDO = 'saldo_inicial';
        const formatCurrency = v => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);
        const categoryLabels = {
            alimentacao: 'Alimentação',
            transporte: 'Transporte',
            apostas: 'Apostas Esportivas',
            cassino: 'Cassino',
            cripto: 'Criptomoedas',
            pagamento_videos: 'Pagamento por Vídeos',
            outros: 'Outros'
        };

        let transactions = [];
        let currentTipo = 'despesa';

        // --- Funções de Estado e Dados ---
        function setInitialBalance(value) {
            localStorage.setItem(STORAGE_SALDO, value.toString());
            updateDashboard();
        }

        // --- Funções de Lógica da UI ---
        function updateDateHeader() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('pt-BR', options);
        }

        function setTipo(tipo) {
            currentTipo = tipo;
            const btnR = document.getElementById('btn-receita');
            const btnD = document.getElementById('btn-despesa');

            btnR.classList.remove('active', 'bg-green-600', 'text-white');
            btnD.classList.remove('active', 'bg-red-600', 'text-white');

            if (tipo === 'receita') {
                btnR.classList.add('active', 'bg-green-600', 'text-white');
            } else {
                btnD.classList.add('active', 'bg-red-600', 'text-white');
            }
        }

        // --- Funções de Comunicação com a API ---
        async function loadTransactions(filter = 'all') {
            const tbody = document.getElementById('transactions-list');
            tbody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-gray-500">Carregando...</td></tr>`;

            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`Erro na rede: ${response.statusText}`);

                let data = await response.json();

                if (filter === 'today') {
                    const today = new Date().toISOString().slice(0, 10);
                    data = data.filter(t => t.data.startsWith(today));
                }

                transactions = data;
                renderTransactions();
            } catch (error) {
                console.error("Falha ao carregar transações:", error);
                tbody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-gray-500">Falha ao carregar transações. Verifique o console.</td></tr>`;
            }
        }

        async function addTransaction() {
            const descricao = document.getElementById('descricao').value.trim();
            const valor = parseFloat(document.getElementById('valor').value || '0');
            const categoria = document.getElementById('categoria').value;
            const data = document.getElementById('data').value;

            if (!descricao || !data || !valor || valor <= 0) {
                return alert('Preencha todos os campos obrigatórios.');
            }

            const newTransaction = { tipo: currentTipo, descricao, valor, categoria, data };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newTransaction)
                });

                if (!response.ok) throw new Error('Erro ao adicionar transação');

                loadTransactions('all');

                document.getElementById('descricao').value = '';
                document.getElementById('valor').value = '';
                document.getElementById('data').valueAsDate = new Date();
                document.getElementById('descricao').focus();
            } catch (error) {
                console.error(error);
                alert('Falha ao adicionar transação.');
            }
        }

        async function deleteTransaction(id) {
            if (!confirm('Excluir transação?')) return;

            try {
                const response = await fetch(`${API_URL}?id=${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Erro ao deletar transação');

                loadTransactions('all');
            } catch (error) {
                console.error(error);
                alert('Falha ao deletar transação.');
            }
        }

        // --- Funções de Renderização na Tela ---
        function renderTransactions() {
            const tbody = document.getElementById('transactions-list');
            tbody.innerHTML = '';

            let listToRender = transactions.slice().sort((a, b) => new Date(b.created_at) - new Date(a.created_at));

            if (listToRender.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="text-center py-8 text-gray-500">Nenhuma transação encontrada</td></tr>`;
            } else {
                for (const t of listToRender) {
                    const tr = document.createElement('tr');
                    tr.className = 'border-b border-gray-200 hover:bg-gray-50';
                    const catClass = {
                        alimentacao: 'bg-yellow-100 text-yellow-800', transporte: 'bg-blue-100 text-blue-800',
                        apostas: 'bg-purple-100 text-purple-800', cassino: 'bg-red-100 text-red-800',
                        cripto: 'bg-orange-100 text-orange-800', pagamento_videos: 'bg-green-100 text-green-800',
                        outros: 'bg-gray-100 text-gray-800'
                    }[t.categoria] || 'bg-gray-100 text-gray-800';
                    const valorHtml = t.tipo === 'receita' ? `<span class="font-medium text-green-600">+ ${formatCurrency(t.valor)}</span>` : `<span class="font-medium text-red-600">- ${formatCurrency(t.valor)}</span>`;
                    tr.innerHTML = `
                        <td class="py-3 text-sm">${formatDisplayDate(t.data)}</td>
                        <td class="py-3 text-sm font-medium">${escapeHtml(t.descricao)}</td>
                        <td class="py-3"><span class="category-badge ${catClass}">${categoryLabels[t.categoria] || t.categoria}</span></td>
                        <td class="py-3 text-right">${valorHtml}</td>
                        <td class="py-3 text-right"><button class="text-sm text-red-600 hover:underline" onclick="deleteTransaction(${t.id})">Excluir</button></td>
                    `;
                    tbody.appendChild(tr);
                }
            }
            updateDashboard();
            updateResume();
        }
        
        function updateDashboard() {
            const totalReceitas = transactions.filter(t => t.tipo === 'receita').reduce((s, t) => s + parseFloat(t.valor), 0);
            const totalGastos = transactions.filter(t => t.tipo === 'despesa').reduce((s, t) => s + parseFloat(t.valor), 0);
            const saldoInicial = parseFloat(localStorage.getItem(STORAGE_SALDO) || '0') || 0;
            const saldoCaixa = saldoInicial + (totalReceitas - totalGastos);
            const today = new Date().toISOString().slice(0, 10);
            const hojeReceitas = transactions.filter(t => t.tipo === 'receita' && t.data.startsWith(today)).reduce((s, t) => s + parseFloat(t.valor), 0);
            const hojeGastos = transactions.filter(t => t.tipo === 'despesa' && t.data.startsWith(today)).reduce((s, t) => s + parseFloat(t.valor), 0);
            const saldoDia = hojeReceitas - hojeGastos;
            const criptoEntradas = transactions.filter(t => t.categoria === 'cripto' && t.tipo === 'receita').reduce((s, t) => s + parseFloat(t.valor), 0);
            const criptoSaidas = transactions.filter(t => t.categoria === 'cripto' && t.tipo === 'despesa').reduce((s, t) => s + parseFloat(t.valor), 0);
            const criptoLiquido = criptoEntradas - criptoSaidas;

            document.getElementById('total-receitas').textContent = formatCurrency(totalReceitas);
            document.getElementById('total-gastos').textContent = formatCurrency(totalGastos);
            document.getElementById('saldo-caixa').textContent = formatCurrency(saldoCaixa);
            document.getElementById('saldo-dia').textContent = formatCurrency(saldoDia);
            const criptoEl = document.getElementById('total-cripto');
            criptoEl.textContent = formatCurrency(criptoLiquido);
            criptoEl.classList.toggle('positive-value', criptoLiquido >= 0);
            criptoEl.classList.toggle('negative-value', criptoLiquido < 0);
        }

        function updateResume() {
            const despesas = {};
            const receitas = {};
            for (const c of Object.keys(categoryLabels)) { despesas[c] = 0; receitas[c] = 0; }
            for (const t of transactions) {
                const valor = parseFloat(t.valor);
                if (t.tipo === 'despesa') despesas[t.categoria] = (despesas[t.categoria] || 0) + valor;
                else receitas[t.categoria] = (receitas[t.categoria] || 0) + valor;
            }

            const despesasEl = document.getElementById('resumo-despesas');
            despesasEl.innerHTML = '';
            Object.entries(categoryLabels).forEach(([key, label]) => {
                if (despesas[key] > 0) {
                    const row = document.createElement('div');
                    row.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-md';
                    row.innerHTML = `<span class="text-gray-600">${label}</span><span class="font-medium text-red-600">${formatCurrency(despesas[key] || 0)}</span>`;
                    despesasEl.appendChild(row);
                }
            });
            if (despesasEl.innerHTML === '') despesasEl.innerHTML = `<p class="text-gray-500">Nenhuma despesa registrada.</p>`;

            const receitasEl = document.getElementById('resumo-receitas');
            receitasEl.innerHTML = '';
            Object.entries(categoryLabels).forEach(([key, label]) => {
                if (receitas[key] > 0) {
                    const row = document.createElement('div');
                    row.className = 'flex justify-between items-center p-3 bg-gray-50 rounded-md';
                    row.innerHTML = `<span class="text-gray-600">${label}</span><span class="font-medium text-green-600">${formatCurrency(receitas[key] || 0)}</span>`;
                    receitasEl.appendChild(row);
                }
            });
            if (receitasEl.innerHTML === '') receitasEl.innerHTML = `<p class="text-gray-500">Nenhuma receita registrada.</p>`;
        }
        
        // --- Funções Utilitárias e de Relatórios ---
        function exportCsv() {
            if (!transactions.length) return alert('Sem transações para exportar.');
            const heads = ['id', 'data', 'tipo', 'categoria', 'descricao', 'valor'];
            const rows = transactions.map(t => [t.id, t.data, t.tipo, t.categoria, `"${(t.descricao || '').replace(/"/g, '""')}"`, t.valor]);
            const csv = [heads.join(','), ...rows.map(r => r.join(','))].join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'transactions.csv';
            a.click();
        }

        function generateReport() {
            const date = document.getElementById('report-date').value;
            if (!date) return alert('Escolha uma data para o relatório.');
            const items = transactions.filter(t => t.data.startsWith(date));
            const outputEl = document.getElementById('report-output');
            if (!items.length) {
                outputEl.innerHTML = `<div class="p-3 bg-gray-50 rounded-md">Sem lançamentos em ${formatDisplayDate(date)}.</div>`;
                return;
            }
            const entradas = items.filter(t => t.tipo === 'receita').reduce((s, t) => s + parseFloat(t.valor), 0);
            const saidas = items.filter(t => t.tipo === 'despesa').reduce((s, t) => s + parseFloat(t.valor), 0);
            const resultado = entradas - saidas;
            let html = `<div class="p-3 bg-gray-50 rounded-md"><div class="mb-2"><strong>${formatDisplayDate(date)}</strong> — Entradas: <strong class="text-green-600">${formatCurrency(entradas)}</strong>, Saídas: <strong class="text-red-600">${formatCurrency(saidas)}</strong>, Resultado: <strong>${formatCurrency(resultado)}</strong></div>`;
            html += `<div class="mt-3"><strong>Lançamentos:</strong><ul class="list-disc pl-5">`;
            for (const it of items.sort((a, b) => new Date(a.created_at) - new Date(b.created_at))) {
                html += `<li>${escapeHtml(it.descricao)} — ${it.tipo === 'receita' ? '+' : '-'} ${formatCurrency(it.valor)}</li>`;
            }
            html += `</ul></div></div>`;
            outputEl.innerHTML = html;
        }

        function formatDisplayDate(d) {
            if (!d) return '';
            const datePart = d.split('T')[0];
            const parts = datePart.split('-');
            if (parts.length !== 3) return d;
            return parts[2] + '/' + parts[1] + '/' + parts[0];
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#x27;' }[m]));
        }

        // --- Inicialização ---
        function init() {
            // Event Listeners
            document.getElementById('saldo-inicial').addEventListener('change', e => setInitialBalance(parseFloat(e.target.value) || 0));
            document.getElementById('btn-receita').addEventListener('click', () => setTipo('receita'));
            document.getElementById('btn-despesa').addEventListener('click', () => setTipo('despesa'));
            document.getElementById('transaction-form').addEventListener('submit', e => { e.preventDefault(); addTransaction(); });
            document.getElementById('filter-today').addEventListener('click', () => loadTransactions('today'));
            document.getElementById('filter-all').addEventListener('click', () => loadTransactions('all'));
            document.getElementById('export-csv').addEventListener('click', exportCsv);
            document.getElementById('generate-report').addEventListener('click', generateReport);

            // Initial state
            const savedSaldo = parseFloat(localStorage.getItem(STORAGE_SALDO) || '0');
            document.getElementById('saldo-inicial').value = savedSaldo ? savedSaldo.toFixed(2) : '';
            document.getElementById('data').valueAsDate = new Date();
            document.getElementById('report-date').valueAsDate = new Date();
            setTipo('despesa');

            // First load
            updateDateHeader();
            loadTransactions('all');
            document.getElementById('descricao').focus();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
